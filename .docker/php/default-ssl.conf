<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    ServerName ${SERVER_NAME}
    ServerAlias *.${SERVER_NAME}
    DocumentRoot /var/www/public

    AllowEncodedSlashes On

    ErrorDocument 400 /errors/400.php
    ErrorDocument 401 /errors/401.php
    ErrorDocument 402 /errors/402.php
    ErrorDocument 403 /errors/403.php
    ErrorDocument 404 /errors/404.php
    ErrorDocument 405 /errors/405.php
    ErrorDocument 406 /errors/406.php
    ErrorDocument 408 /errors/408.php
    ErrorDocument 410 /errors/410.php
    ErrorDocument 415 /errors/415.php
    ErrorDocument 500 /errors/500.php
    ErrorDocument 501 /errors/501.php
    ErrorDocument 503 /errors/503.php
    ErrorDocument 505 /errors/505.php

    <Directory /var/www/public>
        Options -Indexes
        AllowOverride All
        Order allow,deny
        allow from all
    </Directory>

    <IfModule mod_expires.c>
        <FilesMatch "(?i)\.(jpe?g|png|gif)$">
            ExpiresActive On
            ExpiresDefault "access plus 52 weeks"
        </FilesMatch>
        <FilesMatch "(?i)\.(css|js)$">
            ExpiresActive On
            ExpiresDefault "access plus 1 week"
        </FilesMatch>
    </IfModule>

    <IfModule mod_speling.c>
        CheckSpelling On
        CheckCaseOnly On
    </IfModule>

    <Files ~ "(?i)\.ini$">
        Order allow,deny
        Deny from all
    </Files>
    <Files ~ "(?i)\.env$">
        Order allow,deny
        Deny from all
    </Files>

    IndexIgnore *

    RewriteEngine On

    RewriteCond %{HTTP_HOST} ^blog.${SERVER_NAME}$
    RewriteRule ^/(.*)$      https://${SERVER_NAME}/blog [R=301,QSA]
    # Match only subdomains of mydomain.com
    RewriteCond %{HTTP_HOST} ^www.${SERVER_NAME}$
    RewriteRule (.*) https://${SERVER_NAME}$1 [R=301,QSA]
    # Other redirect rules
    RewriteRule ^/Information/privia.php                                    /commercial/privia.php  [R=301]
    RewriteRule ^/Blog/(\d{4})%2F(\d{2})%2F(\d{2})%2F([-\s\w%+\d]+)$        /Blog/$1/$2/$3/$4       [NC,NE,R=301]
    RewriteRule ^/Blog/(\d{4})/(\d{2})/(\d{2})/([-\s\w%+\d]+)$              /blog/search.php?s=$4   [NC,R=301]
    RewriteRule ^/Blog/Category                                             /blog/categories.php    [R=301]
    RewriteRule ^/blog/Category                                             /blog/categories.php    [R=301]
    RewriteRule ^/blog/all.php                                              /blog/                  [R=301]
    RewriteRule ^/wp-login.php                                              /errors/403.php         [NC,L]
    #protect our images
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}    [NC]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}.*$ [NC]
    RewriteRule ^(.*)preview_image.jpg              -                       [L]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}    [NC]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}.*$ [NC]
    RewriteRule ^/img/2014websitelogo250px.png      -                       [L]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}    [NC]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}.*$ [NC]
    RewriteRule ^/favicon.ico                       -                       [L]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}    [NC]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}.*$ [NC]
    RewriteRule ^/img/favicon/(.*)                  -                       [L]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}    [NC]
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?${SERVER_NAME}.*$ [NC]
    RewriteRule (?i)\.(png|gif|jpg|jpeg)$               -                       [F]


</VirtualHost>